services:
  # DyGIE++ extraction container
  dygiepp:
    build:
      context: ./src/extraction/dygiepp
      dockerfile: Dockerfile
    container_name: cskg-dygiepp
    image: cskg-dygiepp:latest
    
    volumes:
      # Mount data directories
      - ./data:/dygiepp/data
      - ./src/extraction:/dygiepp/extraction
    
    working_dir: /dygiepp
    
    stdin_open: true
    tty: true
    
    command: /bin/bash
  
  # Main pipeline container (construction, validation, post-processing)
  cskg-pipeline:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: cskg-pipeline
    image: cskg-pipeline:latest
    
    # Mount volumes for data persistence
    volumes:
      # Data directories
      - ./data:/workspace/data
      - ./dataset:/workspace/dataset
      
      # Source code (for development)
      - ./src:/workspace/src
    
    # Environment variables (adjust as needed)
    environment:
      - PYTHONPATH=/workspace/src:/workspace/src/construction
      - SUPPORT_S1=3
      - SUPPORT_S2=3
    
    # Keep container running for interactive use
    stdin_open: true
    tty: true
    
    # Resource limits (adjust based on your system)
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '2'
          memory: 4G
    
    # Working directory
    working_dir: /workspace
    
    # Default command
    command: /bin/bash
